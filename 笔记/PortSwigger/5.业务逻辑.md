# 业务逻辑漏洞

业务逻辑漏洞是应用程序设计和实现中的缺陷，允许攻击者引发意外行为。这可能使攻击者能够操纵合法功能以实现恶意目标。这些缺陷通常是由于未能预测可能发生的异常应用程序状态，因此未能安全处理它们。

## 过度信任客户端控制

一个根本有缺陷的假设是用户只会通过提供的 Web 界面与应用程序交互。这尤其危险，因为它导致进一步假设客户端验证将阻止用户提供恶意输入。但是，攻击者可以简单地使用 Burp Proxy 等工具在数据由浏览器发送之后但在数据传递到服务器端逻辑之前对其进行篡改。这有效地使客户端控件无用。

接受表面价值的数据，而不执行适当的完整性检查和服务器端验证，可以让攻击者以相对最小的努力造成各种破坏。他们能够实现的确切目标取决于功能以及它对可控数据的作用。在适当的情况下，这种缺陷可能对业务相关功能和网站本身的安全性造成毁灭性后果。

## 无法处理非常规输入

应用程序逻辑的目的之一是将用户输入限制为符合业务规则的值。例如，应用程序可能被设计为接受某种数据类型的任意值，但逻辑从业务的角度确定该值是否可接受。许多应用程序将数字限制纳入其逻辑。这可能包括旨在管理库存、应用预算限制、触发供应链阶段等的限制。

如果逻辑不能充分阻止用户在参数中提供负值amount，攻击者可能会利用这一点绕过余额检查并将资金转移到“错误”的方向。如果攻击者将 -$1000 发送到受害者的帐户，这可能会导致他们从受害者那里收到 1000 美元。逻辑将始终评估 -1000 小于当前余额并批准转移。

在审核应用程序时，您应该使用 Burp Proxy 和 Repeater 等工具来尝试提交非常规值。特别是，尝试在合法用户不太可能输入的范围内输入。这包括异常高或异常低的数字输入以及基于文本的字段的异常长字符串。您甚至可以尝试意外的数据类型。

## 对用户行为做出有缺陷的假设

逻辑漏洞 最常见的根本原因之一是对用户行为做出有缺陷的假设。这可能导致开发人员没有考虑违反这些假设的潜在危险场景的广泛问题。

### 受信任的用户并不总是值得信任

应用程序可能看起来是安全的，因为它们实施了看似强大的措施来强制执行业务规则。不幸的是，一些应用程序错误地假设，在最初通过这些严格控制后，用户及其数据可以无限期地被信任。这可能导致从那时起对相同控制的执行相对宽松。如果在整个应用程序中没有一致地应用业务规则和安全措施，这可能会导致潜在的危险漏洞，攻击者可能会利用这些漏洞。

*例子*
在通过严格的审查通过的用户，做出破坏性操作

### 用户不会总是提供强制输入

一种误解是用户总是会为必填字段提供值。浏览器可能会阻止普通用户在没有必要输入的情况下提交表单，但众所周知，攻击者可以在传输过程中篡改参数。这甚至扩展到完全删除参数。

在探查逻辑缺陷时，应尝试依次删除每个参数，并观察其对响应的影响。您应该确保：

* 一次只删除一个参数，以确保到达所有相关的代码路径。
* 尝试删除参数的名称以及值。服务器通常会以不同的方式处理这两种情况。
* 遵循多阶段流程直至完成。有时在一个步骤中篡改参数会对工作流程中的另一步骤产生影响。

### 用户不会总是遵循预期的顺序

许多事务依赖于由一系列步骤组成的预定义工作流。Web 界面通常会引导用户完成此过程，每次完成当前流程时，都会将他们带到工作流程的下一步。但是，攻击者不一定会遵守这个预期的顺序。未能考虑到这种可能性可能会导致可能相对容易利用的危险缺陷。

例如，许多实施双重身份验证 (2FA) 的网站要求用户在一个页面上登录，然后在另一个页面上输入验证码。假设用户将始终遵循此过程直到完成，因此，如果不验证他们是否这样做，可能会允许攻击者完全绕过 2FA 步骤。

## 特定领域的缺陷

例如，考虑一个在线商店，它为超过 1000 美元的订单提供 10% 的折扣。如果业务逻辑无法检查应用折扣后订单是否已更改，这可能容易被滥用。
在这种情况下，攻击者可以简单地将商品添加到他们的购物车，直到它们达到 1000 美元的门槛，然后在下订单之前移除他们不想要的商品。然后，即使订单不再满足预期标准，他们也会收到折扣。

## 提供加密预言

当用户可控制的输入被加密并且生成的密文随后以某种方式提供给用户时，可能会发生危险的情况。这种输入有时被称为“加密预言机”。攻击者可以使用此输入使用正确的算法和非对称密钥加密任意数据。当应用程序中有其他用户可控的输入期望使用相同算法加密的数据时，这会变得很危险。在这种情况下，攻击者可能会使用加密预言机生成有效的加密输入，然后将其传递给其他敏感函数。