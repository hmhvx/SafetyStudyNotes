# 不安全的反序列化

**序列化**是将复杂数据结构（例如对象及其字段）转换为“更扁平”格式的过程，该格式可以作为顺序字节流发送和接收。序列化数据使以下操作变得更加简单：

-   将复杂数据写入进程间内存、文件或数据库
-   例如，通过网络、应用程序的不同组件之间或在 API 调用中发送复杂数据

至关重要的是，当序列化一个对象时，它的状态也是持久的。换句话说，对象的属性及其分配的值被保留。

序列化与反序列化

**反序列化**是将此字节流恢复为原始对象的完整功能副本的过程，其状态与序列化时的状态完全相同。然后网站的逻辑可以与这个反序列化的对象进行交互，就像它与任何其他对象一样。




## 如何防止不安全的反序列化漏洞

一般来说，除非绝对必要，否则应避免对用户输入进行反序列化。在许多情况下，它可能实现的高严重性漏洞利用以及防御漏洞利用的难度超过了收益。

如果您确实需要对来自不受信任来源的数据进行反序列化，请采用可靠的措施以确保数据未被篡改。例如，您可以实施数字签名来检查数据的完整性。但是，请记住，必须**在**开始反序列化过程之前进行任何检查。否则，它们几乎没有用处。

如果可能，您应该完全避免使用通用反序列化功能。这些方法的序列化数据包含原始对象的所有属性，包括可能包含敏感信息的私有字段。相反，您可以创建自己的特定于类的序列化方法，以便您至少可以控制公开哪些字段。

最后，请记住，漏洞是用户输入的反序列化，而不是随后处理数据的小工具链的存在。不要依赖于尝试消除您在测试期间识别的小工具链。由于几乎可以肯定您的网站上存在跨库依赖关系的网络，因此尝试将它们全部插入是不切实际的。在任何给定时间，公开记录的内存损坏漏洞也是一个因素，这意味着您的应用程序无论如何都可能容易受到攻击。